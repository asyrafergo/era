<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Initial ERA Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h2 {
      text-align: center;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      vertical-align: top;
    }
    th {
      background-color: #d9d9d9;
      text-align: center;
    }
    .col-D { background-color: #dbe7f5; }
    .col-E { background-color: #fff2cc; }
    .col-F { background-color: #d9ead3; }
    .checkbox-list {
      text-align: center;
    }
        .checkbox-container {
        display: flex;
        justify-content: center;
        margin-top: 10px;
    }
    .button-container {
      margin-top: 20px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
    }
    th.col-F {
    display: none;
}
td.col-F {
    display: none;
}
  </style>
</head>
<body>

<h2>Initial ERA Form</h2>
<table id="eraTable">
  <thead>
    <tr>
      <th>Risk Factor</th>
      <th>Total score</th>
      <th>Minimum Requirements for Advance ERA</th>
      <th class="col-D" style="width: 250px;">Result of Initial ERA</th>
      <th class="col-E">Any pain or discomfort due to risk factors as found in MSD assessment Refer Part 3.1 (Yes/No)<br></th>
      <th class="col-F">Need advanced ERA (Yes/No) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
        <td style="text-align: center;">Awkward posture</td><td style="text-align: center;">13</td><td style="text-align: center;">≥ 6</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-E" rowspan="9">
            <div class="checkbox-list">
              If YES please tick which part of body:<br>
              <label><input type="checkbox" name="body" value="Neck"> Neck</label><br>
              <label><input type="checkbox" name="body" value="Shoulder"> Shoulder</label><br>
              <label><input type="checkbox" name="body" value="Upper back"> Upper back</label><br>
              <label><input type="checkbox" name="body" value="Lower back"> Lower back</label><br>
              <label><input type="checkbox" name="body" value="Upper arm"> Upper arm</label><br>
              <label><input type="checkbox" name="body" value="Elbow"> Elbow</label><br>
              <label><input type="checkbox" name="body" value="Lower Arm"> Lower Arm</label><br>
              <label><input type="checkbox" name="body" value="Hand/Wrist"> Hand/Wrist</label><br>
              <label><input type="checkbox" name="body" value="Thigh"> Thigh</label><br>
              <label><input type="checkbox" name="body" value="Knee"> Knee</label><br>
              <label><input type="checkbox" name="body" value="Lower leg"> Lower leg</label><br>
              <label><input type="checkbox" name="body" value="Ankle/Foot"> Ankle/Foot</label>
            </div>
          </td></td><td class="col-F"></td>
    </tr>
    <tr>
        <td style="text-align: center;">Static and sustained work posture</td><td style="text-align: center;">3</td><td style="text-align: center;">≥ 1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td>
    </tr>
    <tr>
        <td style="text-align: center;">Forceful exertion</td>
      <td style="text-align: center;">1</td>
      <td style="text-align: center;">1</td>
      <td class="col-D">
        <div class="checkbox-list">
            <label>Lifting/Lowering: <input type="number" name="action" data-label="Lifting/Lowering" min="0" style="width: 60px;"></label><br>
            <label>Pushing/Pulling: <input type="number" name="action" data-label="Pushing/Pulling" min="0" style="width: 60px;"></label><br>
            <label>Handling Load in Seated: <input type="number" name="action" data-label="Handling Load in Seated" min="0" style="width: 60px;"></label><br>
            <label>Carrying: <input type="number" name="action" data-label="Carrying" min="0" style="width: 60px;"></label><br>
            <label>Other: <input type="number" name="action" data-label="Other" min="0" style="width: 60px;"></label>
          </div>          
      </td>
      <td class="col-F"></td>
    </tr>
    <tr><td style="text-align: center;">Repetition</td><td style="text-align: center;">5</td><td style="text-align: center;">≥ 1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td></tr>
    <tr><td style="text-align: center;">Vibration</td><td style="text-align: center;">4</td><td style="text-align: center;">≥ 1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td></tr>
    <tr><td style="text-align: center;">Lighting</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td></tr>
    <tr><td style="text-align: center;">Temperature</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td></tr>
    <tr><td style="text-align: center;">Ventilation</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td></tr>
    <tr><td style="text-align: center;">Noise</td><td style="text-align: center;">2</td><td style="text-align: center;">≥ 1</td><td class="col-D"><input type="number" name="result[]" min="0" style="width: 100%; border: none; text-align: center;"></td><td class="col-F"></td></tr>
  </tbody>
</table>

<div class="button-container">
  <button onclick="generatePDF()">Generate PDF</button>
</div>

<script>
    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
  
      doc.setFontSize(16);
      doc.text("Initial ERA Form", 105, 15, null, null, "center");
  
      // Collect Result of Initial ERA values
      const resultInputs = document.querySelectorAll('input[name="result[]"]');
      const results = Array.from(resultInputs).map(input => input.value || "0");
  
      const actionInputs = document.querySelectorAll('input[name="action"]');
      const actions = Array.from(actionInputs).map(input => {
  const label = input.dataset.label;
  const value = input.value.trim() === "" ? "0" : input.value.trim();
  return { label, value };
});

const needAdvancedERA = actions.some(action => parseFloat(action.value) > 0) ? "Yes" : "No";

const actionsText = actions
  .filter(action => action.value)
  .map(action => `${action.label}: ${action.value}`)
  .join('\n');

  
      // Define all possible body parts
const allBodyParts = [
  "Neck", "Shoulder", "Upper back", "Lower back",
  "Upper arm", "Elbow", "Lower Arm", "Hand/Wrist",
  "Thigh", "Knee", "Lower leg", "Ankle/Foot"
];

// Collect checked body parts
const checkedBodyParts = Array.from(document.querySelectorAll('input[name="body"]:checked'))
  .map(input => input.value);

// Construct the body text with '/' for selected parts
let bodyText = "If YES please tick which part of body:\n\n";
bodyText += allBodyParts.map(part => checkedBodyParts.includes(part) ? `/   ${part}` : part).join('\n');

  
      // Determine "Need advanced ERA" status
      function getNeedAdvancedERA(value) {
        return parseFloat(value) > 0 ? "Yes" : "No";
      }

      // Debugging: Check the values in each row before generating PDF
  const rows = [
    ['Awkward posture', '13', '1-6', results[0], '', getNeedAdvancedERA(results[0])],
    ['Static and sustained work posture', '3', '1', results[1], '', getNeedAdvancedERA(results[1])],
    ['Forceful exertion', '1', '1', actions.map(a => `${a.label}: ${a.value}`).join('\n'), bodyText.trim(), needAdvancedERA],
    ['Repetition', '5', '1', results[2], '', getNeedAdvancedERA(results[2])],
    ['Vibration', '4', '1', results[3], '', getNeedAdvancedERA(results[3])],
    ['Lighting', '1', '1', results[4], '', getNeedAdvancedERA(results[4])],
    ['Temperature', '1', '1', results[5], '', getNeedAdvancedERA(results[5])],
    ['Ventilation', '1', '1', results[6], '', getNeedAdvancedERA(results[6])],
    ['Noise', '2', '1', results[7], '', getNeedAdvancedERA(results[7])]
  ];

  console.log("Rows for PDF:", rows); // Debugging output for the row data
  
      // Build table
      doc.autoTable({
        startY: 25,
        head: [[
          'Risk Factor', 'Total score', 'Minimum Requirements for Advance ERA',
          'Result of Initial ERA', 'Any pain or discomfort (Yes/No)', 'Need advanced ERA (Yes/No)'
        ]],
        body: rows,
        styles: {
          halign: 'center',
          valign: 'middle',
          fontSize: 8
        },
        columnStyles: {
          3: { cellWidth: 40, fillColor: [219, 231, 245] },
          4: { cellWidth: 40, fillColor: [255, 242, 204], halign: 'left' },
          5: { cellWidth: 20, fillColor: [217, 234, 211] }
        },
        didParseCell: function (data) {
    // Target only the "body part" cell (column index 4) for the Forceful exertion row (row index 2)
    if (data.row.index === 2 && data.column.index === 4) {
      data.cell.styles.halign = 'center'; // Center-align
      data.cell.styles.valign = 'middle'; // Vertical center (optional)
    }
  }

      });
  
      doc.save("Initial_ERA_Form.pdf");
    }
  </script>  

</body>
</html>
