<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registration - Initial ERA</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 40px 20px;
      color: #333;
    }

    .form-container {
      background-color: #fff;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 30px;
      border-radius: 15px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      border-top: 10px solid #c00000;
      text-align: center;
    }

    h1 {
      color: #c00000;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 16px;
      color: #666;
      margin-bottom: 25px;
    }

    .details, .payment, .contact {
      background-color: #f2f2f2;
      padding: 20px;
      border-radius: 10px;
      text-align: left;
      margin-bottom: 25px;
    }

    label {
      display: block;
      margin-top: 20px;
      text-align: left;
      font-weight: bold;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    input[type="file"] {
      padding: 6px;
    }

    button {
      margin-top: 30px;
      background-color: #c00000;
      color: white;
      border: none;
      padding: 14px 30px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #a00000;
    }

    a {
      color: #c00000;
      text-decoration: none;
    }

    @media (max-width: 600px) {
      .form-container {
        padding: 30px 20px;
      }

      h1 {
        font-size: 22px;
      }
    }
  </style>
</head>
<body>

  <div class="form-container">
    <h1>Registration</h1>
    <h1 id="programTitle">Program Title</h1>
<div class="subtitle" id="programDetails">Loading details...</div

    <form>
      <label for="name">Your Full Name</label>
      <input type="text" id="name" name="name" required />

      <label for="ic">Your IC No (XXXXXX-XX-XXXX)</label>
      <input type="text" id="ic" name="ic" required />

      <label for="email">Your Email</label>
      <input type="email" id="email" name="email" required />

      <label for="phone">Your Telephone No</label>
      <input type="tel" id="phone" name="phone" required />

      <label for="company">Your Company Name and Address</label>
      <textarea id="company" name="company" rows="3" required></textarea>

      <label for="fee">Select Your Fee Option</label>
      <select id="fee" name="fee" required>
  <option value="">-- Please Select --</option>
</select>

      <label for="receipt">Upload Your Payment Receipt (Max 5 files, 10MB each)</label>
      <input type="file" id="receipt" name="receipt" multiple accept=".pdf,.jpg,.jpeg,.png" />

      <div class="payment">
        <p><strong>Payment Details:</strong></p>
        <p>Bank: RHB Bank</p>
        <p>Account No: 202126 0001 1806</p>
        <p>Account Name: Northern Ergonomics Solutions PLT</p>
        <p>Registration No: LLP0020213LGN</p>
      </div>

      <div class="contact">
        <p><strong>Contact:</strong></p>
        <p>ðŸ“ž 010-7757753 â€“ Call / WhatsApp</p>
        <p>ðŸ“ž 010-7757752 â€“ Call / WhatsApp</p>
        <p>ðŸ“§ <a href="mailto:NorthernErgonomicsSolutions@gmail.com">NorthernErgonomicsSolutions@gmail.com</a></p>
      </div>

      <button type="submit">Submit Registration</button>
    </form>
  </div>

  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, onValue  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAxfj2GwpREdwwvSL1_LhTUnSWAUwUT9pQ",
  authDomain: "ergo-1140d.firebaseapp.com",
  databaseURL: "https://ergo-1140d-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "ergo-1140d",
  storageBucket: "ergo-1140d.appspot.com",
  messagingSenderId: "139659476541",
  appId: "1:139659476541:web:78fd5c1593fae30f747454",
  measurementId: "G-NNGVRF3E5D"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let hasLoaded = false;

function formatDateRange(dates) {
  const [startStr, endStr] = dates.split(" to ");
  const start = new Date(startStr);
  const end = new Date(endStr);
  const day1 = start.getDate();
  const day2 = end.getDate();
  const month = end.toLocaleString('en-US', { month: 'long' });
  const year = end.getFullYear();
  return `${day1}â€“${day2} ${month} ${year}`;
}

function formatDeadline(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
}

function loadProgramToPage(program) {
  // Set program title and details
  document.getElementById("programTitle").textContent = program.title || "Program Title";
  document.getElementById("programDetails").textContent =
    `${formatDateRange(program.dates)}, ${program.venue}`;

  // Populate fee options
const feeSelect = document.getElementById("fee");
feeSelect.innerHTML = '<option value="">-- Please Select --</option>';

Object.entries(program).forEach(([key, fee]) => {
  if (key.startsWith("fee") && typeof fee === "object") {
    const amount = fee.amount ?? "-";
    const category = fee.category ?? "-";
    const label = fee.label ? ` / ${fee.label}` : "";
    const deadlineType = fee.deadlineType ?? "";
    const deadlineDate = fee.deadlineDate ? formatDeadline(fee.deadlineDate) : "";
    const method = fee.method ? ` / ${fee.method}` : "";

    const displayText = `RM${amount} - ${category}${label} / ${deadlineType} ${deadlineDate}${method}`;

    const option = document.createElement("option");
    option.value = `rm${amount}`;
    option.textContent = displayText;
    feeSelect.appendChild(option);
  }
});
}

function watchForProgramUpdates() {
  const programRef = ref(db, 'users/user1/Program');
  onValue(programRef, (snapshot) => {
    if (!snapshot.exists()) return;

    const programs = snapshot.val();
    const keys = Object.keys(programs).sort();
    const latestKey = keys[keys.length - 1];
    const program = programs[latestKey];

    const newTitle = program.title || "Program Title";
    const newDetails = `${formatDateRange(program.dates)}, ${program.venue}`;
    const currentTitle = document.getElementById("programTitle").textContent;
    const currentDetails = document.getElementById("programDetails").textContent;

    if (!hasLoaded) {
      hasLoaded = true;
      loadProgramToPage(program);
    } else {
      const hasChanged = newTitle !== currentTitle || newDetails !== currentDetails;
      if (hasChanged) {
        location.reload();
      }
    }
  });
}

document.addEventListener("DOMContentLoaded", () => {
  watchForProgramUpdates();
});

</script>

</body>
</html>
